!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?e(exports,require("@angular/core"),require("rxjs"),require("rxjs/operators"),require("@angular/common/http")):"function"==typeof define&&define.amd?define("ng2-ui-auth",["exports","@angular/core","rxjs","rxjs/operators","@angular/common/http"],e):e(t["ng2-ui-auth"]={},t.ng.core,t.rxjs,t.rxjs.operators,t.ng.common.http)}(this,function(t,n,c,a,i){"use strict";var s=function(t,e){return(s=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var o in e)e.hasOwnProperty(o)&&(t[o]=e[o])})(t,e)};var l=function(){return(l=Object.assign||function(t){for(var e,o=1,r=arguments.length;o<r;o++)for(var n in e=arguments[o])Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n]);return t}).apply(this,arguments)};function o(t,e){var o="function"==typeof Symbol&&t[Symbol.iterator];if(!o)return t;var r,n,i=o.call(t),a=[];try{for(;(void 0===e||0<e--)&&!(r=i.next()).done;)a.push(r.value)}catch(s){n={error:s}}finally{try{r&&!r.done&&(o=i["return"])&&o.call(i)}finally{if(n)throw n.error}}return a}function d(){for(var t=[],e=0;e<arguments.length;e++)t=t.concat(o(arguments[e]));return t}var e="none",p="memory",u="localStorage",h="sessionStorage",f="cookie",g="sessionCookie",r=new n.InjectionToken("config.options"),y={withCredentials:!1,tokenRoot:null,baseUrl:"/",loginUrl:"/auth/login",signupUrl:"/auth/signup",unlinkUrl:"/auth/unlink/",tokenName:"token",tokenSeparator:"_",tokenPrefix:"ng2-ui-auth",authHeader:"Authorization",authToken:"Bearer",storageType:u,cordova:null,resolveToken:function(t,e){var o=t&&(t.access_token||t.token||t.data);if(!o)return null;if("string"==typeof o)return o;if("object"!=typeof o)return null;var r=e.tokenRoot&&e.tokenRoot.split(".").reduce(function(t,e){return t[e]},o),n=r?r[e.tokenName]:o[e.tokenName];return n||null},providers:{facebook:{name:"facebook",url:"/auth/facebook",authorizationEndpoint:"https://www.facebook.com/v2.5/dialog/oauth",additionalUrlParams:{display:"popup"},scope:["email"],scopeDelimiter:",",oauthType:"2.0",popupOptions:{width:580,height:400}},google:{name:"google",url:"/auth/google",authorizationEndpoint:"https://accounts.google.com/o/oauth2/auth",additionalUrlParams:{display:"popup",prompt:undefined,login_hint:undefined,access_type:undefined,include_granted_scopes:undefined,"openid.realm":undefined,hd:undefined},scope:["openid","profile","email"],scopeDelimiter:" ",oauthType:"2.0",popupOptions:{width:452,height:633},state:function(){return encodeURIComponent(Math.random().toString(36).substr(2))}},github:{name:"github",url:"/auth/github",authorizationEndpoint:"https://github.com/login/oauth/authorize",scope:["user:email"],scopeDelimiter:" ",oauthType:"2.0",popupOptions:{width:1020,height:618}},instagram:{name:"instagram",url:"/auth/instagram",authorizationEndpoint:"https://api.instagram.com/oauth/authorize",scope:["basic"],scopeDelimiter:"+",oauthType:"2.0"},linkedin:{name:"linkedin",url:"/auth/linkedin",authorizationEndpoint:"https://www.linkedin.com/uas/oauth2/authorization",scope:["r_emailaddress"],scopeDelimiter:" ",oauthType:"2.0",popupOptions:{width:527,height:582},state:"STATE"},twitter:{name:"twitter",url:"/auth/twitter",authorizationEndpoint:"https://api.twitter.com/oauth/authenticate",oauthType:"1.0",popupOptions:{width:495,height:645}},twitch:{name:"twitch",url:"/auth/twitch",authorizationEndpoint:"https://api.twitch.tv/kraken/oauth2/authorize",scope:["user_read"],scopeDelimiter:" ",additionalUrlParams:{display:"popup"},oauthType:"2.0",popupOptions:{width:500,height:560}},live:{name:"live",url:"/auth/live",authorizationEndpoint:"https://login.live.com/oauth20_authorize.srf",additionalUrlParams:{display:"popup"},scope:["wl.emails"],scopeDelimiter:" ",oauthType:"2.0",popupOptions:{width:500,height:560}},yahoo:{name:"yahoo",url:"/auth/yahoo",authorizationEndpoint:"https://api.login.yahoo.com/oauth2/request_auth",scope:[],scopeDelimiter:",",oauthType:"2.0",popupOptions:{width:559,height:519}},bitbucket:{name:"bitbucket",url:"/auth/bitbucket",authorizationEndpoint:"https://bitbucket.org/site/oauth2/authorize",scope:["email"],scopeDelimiter:",",oauthType:"2.0",popupOptions:{width:1028,height:529}},spotify:{name:"spotify",url:"/auth/spotify",authorizationEndpoint:"https://accounts.spotify.com/authorize",scope:["","user-read-email"],scopeDelimiter:",",oauthType:"2.0",popupOptions:{width:500,height:530},state:function(){return encodeURIComponent(Math.random().toString(36).substr(2))}}}},v=function(){function t(t){var r;r="function"==typeof t?t():t,this.options=l({},y,r,{providers:l({},r.providers,Object.keys(y.providers).concat(Object.keys(r.providers||{})).map(function(t){var e,o;return r.providers&&r.providers[t]?((e={})[t]=l({},y.providers[t],r.providers[t]),e):((o={})[t]=y.providers[t],o)}).reduce(function(t,e){return l({},t,e)},{}))})}return t.decorators=[{type:n.Injectable}],t.ctorParameters=function(){return[{type:undefined,decorators:[{type:n.Inject,args:[r]}]}]},t}(),m=function z(){},w=function(o){function t(t){var e=o.call(this)||this;return e.config=t,e.store={},e.storageType=p,e.updateStorageType(t.options.storageType)||console.warn(t.options.storageType+" is not available."),e}return function r(t,e){function o(){this.constructor=t}s(t,e),t.prototype=null===e?Object.create(e):(o.prototype=e.prototype,new o)}(t,o),t.prototype.updateStorageType=function(t){return!!this.checkIsStorageAvailable(t)&&(this.storageType=t,!0)},t.prototype.get=function(t){switch(this.storageType){case f:case g:return this.getCookie(t);case u:case h:return window[this.storageType].getItem(t);case p:return this.store[t];case e:default:return null}},t.prototype.set=function(t,e,o){switch(this.storageType){case f:case g:this.setCookie(t,e,this.storageType===f?o:"");break;case u:case h:window[this.storageType].setItem(t,e);break;case p:this.store[t]=e}},t.prototype.remove=function(t){switch(this.storageType){case f:case g:this.removeCookie(t);break;case u:case h:window[this.storageType].removeItem(t);break;case p:delete this.store[t]}},t.prototype.checkIsStorageAvailable=function(t){switch(t){case f:case g:return this.isCookieStorageAvailable();case u:case h:return this.isWindowStorageAvailable(t);case e:case p:return!0;default:return!1}},t.prototype.isWindowStorageAvailable=function(t){try{var e=window&&t in window&&null!==window[t];if(e){var o=Math.random().toString(36).substring(7);window[t].setItem(o,""),window[t].removeItem(o)}return e}catch(r){return!1}},t.prototype.isCookieStorageAvailable=function(){try{if(document&&"cookie"in document){var t=Math.random().toString(36).substring(7);this.setCookie(t,"test",new Date(Date.now()+6e4).toUTCString());var e=this.getCookie(t);return this.removeCookie(t),"test"===e}return!1}catch(o){return!1}},t.prototype.setCookie=function(t,e,o,r){void 0===o&&(o=""),void 0===r&&(r="/"),document.cookie=t+"="+e+(o?"; expires="+o:"")+"; path="+r},t.prototype.removeCookie=function(t,e){void 0===e&&(e="/"),this.setCookie(t,"",new Date(0).toUTCString(),e)},t.prototype.getCookie=function(t){return document.cookie.replace(new RegExp("(?:(?:^|.*;\\s*)"+t+"\\s*\\=\\s*([^;]*).*$)|^.*$"),"$1")},t.decorators=[{type:n.Injectable}],t.ctorParameters=function(){return[{type:v}]},t}(m),k=function(){function t(t,e){this.storage=t,this.config=e,this.tokenName=this.config.options.tokenPrefix?[this.config.options.tokenPrefix,this.config.options.tokenName].join(this.config.options.tokenSeparator):this.config.options.tokenName}return t.prototype.getToken=function(){return this.storage.get(this.tokenName)},t.prototype.getPayload=function(t){if(void 0===t&&(t=this.getToken()),t&&3===t.split(".").length)try{var e=t.split(".")[1].replace(/-/g,"+").replace(/_/g,"/");return JSON.parse(this.b64DecodeUnicode(e))}catch(o){return undefined}},t.prototype.setToken=function(t){var e;if(t&&(e="string"==typeof t?t:this.config.options.resolveToken(t,this.config.options))){var o=this.getExpirationDate(e);this.storage.set(this.tokenName,e,o?o.toUTCString():"")}},t.prototype.removeToken=function(){this.storage.remove(this.tokenName)},t.prototype.isAuthenticated=function(t){if(void 0===t&&(t=this.getToken()),t){if(3===t.split(".").length)try{var e=t.split(".")[1].replace(/-/g,"+").replace(/_/g,"/"),o=JSON.parse(this.b64DecodeUnicode(e)).exp;if(o)return!(Math.round((new Date).getTime()/1e3)>=o)||(this.storage.remove(this.tokenName),!1)}catch(r){return!0}return!0}return!1},t.prototype.getExpirationDate=function(t){void 0===t&&(t=this.getToken());var e=this.getPayload(t);if(e&&e.exp&&Math.round((new Date).getTime()/1e3)<e.exp){var o=new Date(0);return o.setUTCSeconds(e.exp),o}return null},t.prototype.logout=function(){var e=this;return c.Observable.create(function(t){e.storage.remove(e.tokenName),t.next(),t.complete()})},t.prototype.setStorageType=function(t){return this.storage.updateStorageType(t)},t.prototype.b64DecodeUnicode=function(t){return decodeURIComponent(Array.prototype.map.call(atob(t),function(t){return"%"+("00"+t.charCodeAt(0).toString(16)).slice(-2)}).join(""))},t.decorators=[{type:n.Injectable}],t.ctorParameters=function(){return[{type:m},{type:v}]},t}();function b(t,e){if(/^(?:[a-z]+:)?\/\//i.test(e))return e;var o=[t,e].join("/");return o.replace(/[\/]+/g,"/").replace(/\/\?/g,"?").replace(/\/\#/g,"#").replace(/\:\//g,"://")}function T(e){return Object.keys(e).map(function(t){return e[t]?encodeURIComponent(t)+"="+encodeURIComponent(e[t]):t}).join("&")}function C(t){void 0===t&&(t=window);try{return t&&t.location?t.location.origin?t.location.origin:t.location.protocol+"//"+t.location.hostname+(t.location.port?":"+t.location.port:""):null}catch(e){return null}}function S(t){if(!t.protocol){var e=document.createElement("a");e.href=t.href,t=e}return t.protocol+"//"+t.hostname+(t.port&&"80"!==t.port&&"443"!==t.port?t.port:"")+(/^\//.test(t.pathname)?t.pathname:"/"+t.pathname)}var O=function(){function t(){}return t.prototype.open=function(t,e,o){var r=this.stringifyOptions(this.prepareOptions(e.popupOptions)),n=(window.navigator.userAgent,(o=null===o?this.isCordovaApp():o)?"_blank":e.name),i=window.open(t,n,r);return i&&i.focus&&i.focus(),o?this.eventListener(i,e.redirectUri||C()):this.pollPopup(i,e.redirectUri||C())},t.prototype.eventListener=function(s,p){var u=this;if(!s)throw new Error("Popup was not created");return c.merge(c.fromEvent(s,"exit").pipe(a.delay(100),a.map(function(){throw new Error("Authentication Canceled")})),c.fromEvent(s,"loadstart")).pipe(a.switchMap(function(t){if(!s||s.closed)return c.Observable["throw"](new Error("Authentication Canceled"));if(0!==t.url.indexOf(p))return c.EMPTY;var e=document.createElement("a");if(e.href=t.url,e.search||e.hash){var o=e.search.substring(1).replace(/\/$/,""),r=e.hash.substring(1).replace(/\/$/,""),n=u.parseQueryString(r),i=u.parseQueryString(o),a=l({},i,n);if(s.close(),a.error)throw a.error;return c.of(a)}return c.EMPTY}),a.take(1))},t.prototype.pollPopup=function(s,t){var p=this,e=document.createElement("a");e.href=t;var u=S(e);return c.interval(50).pipe(a.switchMap(function(){if(!s||s.closed)return c.throwError(new Error("Authentication Canceled"));var t="";try{t=S(s.location)}catch(a){}if(u!==t)return c.EMPTY;if(s.location.search||s.location.hash){var e=s.location.search.substring(1).replace(/\/$/,""),o=s.location.hash.substring(1).replace(/[\/$]/,""),r=p.parseQueryString(o),n=p.parseQueryString(e);s.close();var i=l({},n,r);if(i.error)throw i.error;return c.of(i)}return c.throwError(new Error("No token found after redirect"))}),a.take(1))},t.prototype.prepareOptions=function(t){var e=(t=t||{}).width||500,o=t.height||500;return l({width:e,height:o,left:window.screenX+(window.outerWidth-e)/2,top:window.screenY+(window.outerHeight-o)/2.5,toolbar:t.visibleToolbar?"yes":"no"},t)},t.prototype.stringifyOptions=function(e){return Object.keys(e).map(function(t){return null===e[t]||e[t]===undefined?t:t+"="+e[t]}).join(",")},t.prototype.parseQueryString=function(t){var o;return t.split("&").reduce(function(t,e){return e&&(o=e.split("="),t[decodeURIComponent(o[0])]="undefined"==typeof o[1]||decodeURIComponent(o[1])),t},{})},t.prototype.isCordovaApp=function(){return!(!window||!(window.cordova||window.navigator&&window.navigator.userAgent&&-1<window.navigator.userAgent.indexOf("CriOS")))},t.decorators=[{type:n.Injectable}],t}(),P=function(){function t(t,e,o){this.http=t,this.popup=e,this.config=o}return t.prototype.open=function(r,n){var i=this,t=this.config.options.baseUrl?b(this.config.options.baseUrl,r.url):r.url;return this.http.post(t,r).pipe(a.switchMap(function(t){return i.popup.open([r.authorizationEndpoint,T(t)].join("?"),r,i.config.options.cordova)},function(t,e){return{authorizationData:t,oauthData:e}}),a.switchMap(function(t){var e=t.authorizationData,o=t.oauthData;return i.exchangeForToken(r,e,o,n)}))},t.prototype.exchangeForToken=function(t,e,o,r){var n={authorizationData:e,oauthData:o,userData:r},i=this.config.options,a=i.withCredentials,s=i.baseUrl,p=t.method,u=void 0===p?"POST":p,c=t.url,h=s?b(s,c):c;return this.http.request(u,h,{body:n,withCredentials:a})},t.decorators=[{type:n.Injectable}],t.ctorParameters=function(){return[{type:i.HttpClient},{type:O},{type:v}]},t}(),j=function(){function t(t,e,o){this.http=t,this.popup=e,this.config=o}return t.prototype.open=function(e,o){var r=this,n=this.getAuthorizationData(e),t=[e.authorizationEndpoint,T(n)].join("?");return this.popup.open(t,e,this.config.options.cordova).pipe(a.switchMap(function(t){if("token"===e.responseType||!e.url)return c.of(t);if(t.state&&t.state!==n.state)throw new Error('OAuth "state" mismatch');return r.exchangeForToken(e,n,t,o)}))},t.prototype.exchangeForToken=function(t,e,o,r){var n={authorizationData:e,oauthData:o,userData:r},i=this.config.options,a=i.baseUrl,s=i.withCredentials,p=t.url,u=t.method,c=void 0===u?"POST":u,h=a?b(a,p):p;return this.http.request(c,h,{body:n,withCredentials:s})},t.prototype.getAuthorizationData=function(t){var e=t.responseType,o=void 0===e?"code":e,r=t.clientId,n=t.redirectUri,i=void 0===n?C()||"":n,a=t.scopeDelimiter,s=void 0===a?",":a,p=t.scope,u=t.state,c=t.additionalUrlParams,h="function"==typeof u?u():u;return d([["response_type",o],["client_id",r],["redirect_uri",i]],u?[["state",h]]:[],p?[["scope",p.join(s)]]:[],c?Object.keys(c).map(function(t){var e=c[t];return"string"==typeof e?[t,e]:"function"==typeof e?[t,e()]:null===e?[t,""]:["",""]}):[]).filter(function(t){return!!t[0]}).reduce(function(t,e){var o;return l({},t,((o={})[e[0]]=e[1],o))},{})},t.decorators=[{type:n.Injectable}],t.ctorParameters=function(){return[{type:i.HttpClient},{type:O},{type:v}]},t}(),E=function(){function t(t,e,o,r){this.http=t,this.shared=e,this.config=o,this.popup=r,this.depProviders=[{provide:i.HttpClient,useValue:this.http},{provide:O,useValue:this.popup},{provide:v,useValue:this.config}],this.deps=[i.HttpClient,O,v]}return t.prototype.authenticate=function(e,t){var o=this;return("1.0"===this.config.options.providers[e].oauthType?n.Injector.create(d(this.depProviders,[{provide:P,deps:this.deps}])).get(P):n.Injector.create(d(this.depProviders,[{provide:j,deps:this.deps}])).get(j)).open(this.config.options.providers[e],t||{}).pipe(a.tap(function(t){o.config.options.providers[e].url&&o.shared.setToken(t)}))},t.prototype.unlink=function(t,e,o){return void 0===e&&(e=b(this.config.options.baseUrl,this.config.options.unlinkUrl)),void 0===o&&(o="POST"),this.http.request(o,e,{body:{provider:t}})},t.decorators=[{type:n.Injectable}],t.ctorParameters=function(){return[{type:i.HttpClient},{type:k},{type:v},{type:O}]},t}(),U=function(){function t(t,e,o){this.http=t,this.shared=e,this.config=o}return t.prototype.login=function(t,e){var o=this;return this.http.post(e||b(this.config.options.baseUrl,this.config.options.loginUrl),t).pipe(a.tap(function(t){return o.shared.setToken(t)}))},t.prototype.signup=function(t,e){return this.http.post(e||b(this.config.options.baseUrl,this.config.options.signupUrl),t)},t.decorators=[{type:n.Injectable}],t.ctorParameters=function(){return[{type:i.HttpClient},{type:k},{type:v}]},t}(),D=function(){function t(t,e,o){this.shared=t,this.local=e,this.oauth=o}return t.prototype.login=function(t,e){return this.local.login(t,e)},t.prototype.signup=function(t,e){return this.local.signup(t,e)},t.prototype.logout=function(){return this.shared.logout()},t.prototype.authenticate=function(t,e){return this.oauth.authenticate(t,e)},t.prototype.link=function(t,e){return this.oauth.authenticate(t,e)},t.prototype.unlink=function(t,e){return this.oauth.unlink(t,e)},t.prototype.isAuthenticated=function(){return this.shared.isAuthenticated()},t.prototype.getToken=function(){return this.shared.getToken()},t.prototype.setToken=function(t){this.shared.setToken(t)},t.prototype.removeToken=function(){this.shared.removeToken()},t.prototype.getPayload=function(){return this.shared.getPayload()},t.prototype.setStorageType=function(t){return this.shared.setStorageType(t)},t.prototype.getExpirationDate=function(){return this.shared.getExpirationDate()},t.decorators=[{type:n.Injectable}],t.ctorParameters=function(){return[{type:k},{type:U},{type:E}]},t}(),I=function(){function t(t,e){this.shared=t,this.config=e}return t.prototype.intercept=function(t,e){var o,r=this.config.options,n=r.authHeader,i=r.authToken,a=this.shared.getToken(),s=this.shared.isAuthenticated&&!t.headers.has(n)?t.clone({setHeaders:(o={},o[n]=i+" "+a,o)}):t;return e.handle(s)},t.decorators=[{type:n.Injectable}],t.ctorParameters=function(){return[{type:k},{type:v}]},t}(),x=function(){function o(){}return o.forRoot=function(t,e){return void 0===e&&(e=!0),{ngModule:o,providers:d(t?[{provide:r,useValue:t}]:[],[{provide:v,useClass:v,deps:[r]},{provide:m,useClass:w,deps:[v]},{provide:k,useClass:k,deps:[m,v]}],e?[{provide:i.HTTP_INTERCEPTORS,useClass:I,multi:!0,deps:[k,v]}]:[],[{provide:E,useClass:E,deps:[i.HttpClient,k,v,O]},{provide:O,useClass:O,deps:[v]},{provide:U,useClass:U,deps:[i.HttpClient,k,v]},{provide:D,useClass:D,deps:[k,U,E]}])}},o.decorators=[{type:n.NgModule,args:[{imports:[i.HttpClientModule]}]}],o}();t.Ng2UiAuthModule=x,t.LocalService=U,t.Oauth2Service=j,t.Oauth1Service=P,t.PopupService=O,t.OauthService=E,t.SharedService=k,t.StorageService=m,t.BrowserStorageService=w,t.AuthService=D,t.ConfigService=v,t.JwtInterceptor=I,t.CONFIG_OPTIONS=r,Object.defineProperty(t,"__esModule",{value:!0})});
//# sourceMappingURL=ng2-ui-auth.umd.min.js.map